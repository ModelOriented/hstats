<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model-Agnostic Interaction Statistics • interactML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Model-Agnostic Interaction Statistics">
<meta property="og:description" content="Fast, model-agnostic implementation of interaction strength statistics
    introduced in Friedman, J.H. and Popescu, B.E. (2008)
    &lt;doi:10.1214/07-AOAS148&gt;.  The package supports multivariate
    predictions and can deal with case weights.  Furthermore, different variants
    of the original statistics are provided.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">interactML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mayer79/interactML/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="interactml-">interactML <a href="https://github.com/mayer79/interactML" class="external-link"><img src="reference/figures/logo.png" align="right" height="139"></a>
<a class="anchor" aria-label="anchor" href="#interactml-"></a>
</h1></div>
<!-- badges: start -->


<!-- badges: end -->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>What makes a ML model black-box? It’s the interactions!</strong></p>
<p>This package offers a fast, model-agnostic implementation of Friedman and Popescu’s statistics of interaction strength [2]. As such, it helps to unveil the darkness of the black-box.</p>
<p>The package</p>
<ul>
<li>supports multivariate predictions,</li>
<li>respects case weights, and</li>
<li>works with both data.frames and matrices (e.g., for XGBoost).</li>
</ul>
<p>Furthermore, different variants of the original statistics in [2] are available.</p>
<p>Note: The {gbm} package offers a model-specific implementation of some of the statistics. Since it uses the weighted tree-traversal method of [1] to estimate partial dependence functions, the results are typically slightly different.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mayer79/interactML"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>To demonstrate the typical workflow, we use a beautiful house price dataset with about 14,000 transactions from Miami-Dade County available in the {shapviz} package, and analyzed, e.g., in [3].</p>
<p>We are going to model logarithmic sales prices as a function of geographic features and other features like living area and building age. The model is fitted with XGBoost using interaction constraints to produce a model additive in all non-geographic features.</p>
<p>What can we say about interactions? Can we verify additivity in non-geographic features?</p>
<div class="section level3">
<h3 id="fit-model">Fit model<a class="anchor" aria-label="anchor" href="#fit-model"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/interactML" class="external-link">interactML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ModelOriented/shapviz" class="external-link">shapviz</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variable sets</span></span>
<span><span class="va">x_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LATITUDE"</span>, <span class="st">"LONGITUDE"</span>, <span class="st">"CNTR_DIST"</span>, <span class="st">"OCEAN_DIST"</span>, <span class="st">"RAIL_DIST"</span>, <span class="st">"HWY_DIST"</span><span class="op">)</span></span>
<span><span class="va">x_nongeo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TOT_LVG_AREA"</span>, <span class="st">"LND_SQFOOT"</span>, <span class="st">"structure_quality"</span>, <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x_geo</span>, <span class="va">x_nongeo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build interaction constraint vector</span></span>
<span><span class="va">ic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">x_geo</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">x_nongeo</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train/valid split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">miami</span><span class="op">)</span>, <span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">miami</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">miami</span><span class="op">$</span><span class="va">SALE_PRC</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">y_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">miami</span><span class="op">$</span><span class="va">SALE_PRC</span><span class="op">[</span><span class="op">-</span><span class="va">ix</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">X_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">miami</span><span class="op">[</span><span class="va">ix</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">X_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">miami</span><span class="op">[</span><span class="op">-</span><span class="va">ix</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtrain</span> <span class="op">&lt;-</span> <span class="fu">xgb.DMatrix</span><span class="op">(</span><span class="va">X_train</span>, label <span class="op">=</span> <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">dvalid</span> <span class="op">&lt;-</span> <span class="fu">xgb.DMatrix</span><span class="op">(</span><span class="va">X_valid</span>, label <span class="op">=</span> <span class="va">y_valid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  learning_rate <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  objective <span class="op">=</span> <span class="st">"reg:squarederror"</span>,</span>
<span>  max_depth <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  interaction_constraints <span class="op">=</span> <span class="va">ic</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">xgb.train</span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="va">params</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dtrain</span>,</span>
<span>  watchlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="va">dvalid</span><span class="op">)</span>,</span>
<span>  early_stopping_rounds <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  callbacks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">cb.print.evaluation</span><span class="op">(</span>period <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analyze-interactions">Analyze interactions<a class="anchor" aria-label="anchor" href="#analyze-interactions"></a>
</h3>
<p>To analyze interactions, we will</p>
<ol style="list-style-type: decimal">
<li>call <code><a href="reference/interact.html">interact()</a></code> for the expensive crunching and</li>
<li>get statistics with <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and/or <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2-3 seconds on simple laptop - a random forest will take 1-2 minutes</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  inter <span class="ot">&lt;-</span> <span class="fu">interact</span>(fit, <span class="at">v =</span> x, <span class="at">X =</span> X_train)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(inter)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>Proportion of prediction variability unexplained by main effects of v</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fl">0.09602024</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>Strongest overall interactions</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                         [,<span class="dv">1</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>OCEAN_DIST        <span class="fl">0.062639450</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>LONGITUDE         <span class="fl">0.045194768</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>LATITUDE          <span class="fl">0.029151873</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>CNTR_DIST         <span class="fl">0.027695769</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>RAIL_DIST         <span class="fl">0.003805603</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>HWY_DIST          <span class="fl">0.003484982</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>TOT_LVG_AREA      <span class="fl">0.000000000</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>LND_SQFOOT        <span class="fl">0.000000000</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>structure_quality <span class="fl">0.000000000</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>age               <span class="fl">0.000000000</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>Strongest relative pairwise interactions</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>(only <span class="cf">for</span> features with strong overall interactions)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                            [,<span class="dv">1</span>]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>LONGITUDE<span class="sc">:</span>OCEAN_DIST <span class="fl">0.156475264</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>LONGITUDE<span class="sc">:</span>CNTR_DIST  <span class="fl">0.122113602</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>LONGITUDE   <span class="fl">0.076213847</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>OCEAN_DIST  <span class="fl">0.061130256</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>CNTR_DIST<span class="sc">:</span>OCEAN_DIST <span class="fl">0.040675335</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>RAIL_DIST   <span class="fl">0.030786973</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>CNTR_DIST   <span class="fl">0.029474763</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>CNTR_DIST<span class="sc">:</span>RAIL_DIST  <span class="fl">0.012886536</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>LONGITUDE<span class="sc">:</span>RAIL_DIST  <span class="fl">0.008402545</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>OCEAN_DIST<span class="sc">:</span>RAIL_DIST <span class="fl">0.007081773</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># If {ggplot2} is available, we can also plot the statistics</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(inter)</span></code></pre></div>
<p><img src="reference/figures/interact.svg"></p>
<p><strong>Interpretation</strong></p>
<ul>
<li>About 10% of prediction variability is unexplained by the sum of all main effects.</li>
<li>The strongest overall interactions are associated with “OCEAN_DIST” and “LONGITUDE”. For instance, we can say that about 6% of prediction variability can be attributed to all interactions of “OCEAN_DISTANCE”.</li>
<li>About 15.6% of the joint effect variability of above two features comes from their pairwise interaction.</li>
</ul>
<p><strong>Remarks</strong></p>
<ol style="list-style-type: decimal">
<li>Pairwise statistics are calculated only for the features with strongest overall interactions.</li>
<li>The statistics need to repeatedly calculate predictions on <span class="math inline"><em>n</em><sup>2</sup></span> rows. That is why {interactML} samples 300 rows by default. To get more robust results, increase this value at the price of slower run time.</li>
<li>Pairwise Friedmans and Popescu’s <span class="math inline"><em>H</em><sub><em>j</em><em>k</em></sub><sup>2</sup></span> measures interaction strength relative to the combined effect of the two features. This does not necessarily show which interactions are strongest. To do so, we can study unnormalized statistics:</li>
</ol>
<p>Strongest pairwise interactions (values on the scale of the response log(price)):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">H2_jk</span>(inter, <span class="at">normalize =</span> <span class="cn">FALSE</span>, <span class="at">squared =</span> <span class="cn">FALSE</span>, <span class="at">top_m =</span> <span class="dv">5</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                           [,<span class="dv">1</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>LONGITUDE<span class="sc">:</span>OCEAN_DIST <span class="fl">0.08279401</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>OCEAN_DIST  <span class="fl">0.04797644</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>LONGITUDE<span class="sc">:</span>CNTR_DIST  <span class="fl">0.04796194</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>CNTR_DIST<span class="sc">:</span>OCEAN_DIST <span class="fl">0.04718950</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>LATITUDE<span class="sc">:</span>LONGITUDE   <span class="fl">0.03807378</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, we can use plot() to visualize these values </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># (stat = 2 focusses on pairwise stats)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(inter, <span class="at">stat =</span> <span class="dv">2</span>, <span class="at">normalize =</span> <span class="cn">FALSE</span>, <span class="at">squared =</span> <span class="cn">FALSE</span>, <span class="at">top_m =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="reference/figures/interact_pairwise.svg"></p>
<p><strong>Interpretation:</strong> The strongest pairwise interaction remains the one between longitude and distance to the ocean.</p>
<p>Let’s check a stratified partial dependence plot to get an impression how the interaction looks like:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># "BY" can be a column name in X, or any vector of (possibly transformed) values</span></span>
<span><span class="co"># Numeric features are quantile binned into groups of similar size</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/partial_dep.html">partial_dep</a></span><span class="op">(</span><span class="va">fit</span>, v <span class="op">=</span> <span class="st">"LONGITUDE"</span>, X <span class="op">=</span> <span class="va">X_train</span>, BY <span class="op">=</span> <span class="st">"OCEAN_DIST"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pd</span><span class="op">)</span>  <span class="co"># Requires {ggplot2}</span></span></code></pre></div>
<p><strong>Interpretation:</strong> For short distance to the ocean groups, the LONGITUDE effect looks indeed quite different.</p>
<p><img src="reference/figures/pdp_long_ocean.svg"></p>
<p>As a contrast, the following plots shows perfectly parallel lines (additivity in living area):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/partial_dep.html">partial_dep</a></span><span class="op">(</span><span class="va">fit</span>, v <span class="op">=</span> <span class="st">"TOT_LVG_AREA"</span>, X <span class="op">=</span> <span class="va">X_train</span>, BY <span class="op">=</span> <span class="st">"OCEAN_DIST"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/pdp_living_ocean.svg"></p>
</div>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="partial-dependence">Partial dependence<a class="anchor" aria-label="anchor" href="#partial-dependence"></a>
</h3>
<p>Let <span class="math inline"><em>F</em> : <em>R</em><sup><em>p</em></sup> → <em>R</em></span> denote the prediction function that maps the <span class="math inline"><em>p</em></span>-dimensional feature vector <span class="math inline"><strong>x</strong> = (<em>x</em><sub>1</sub>,…,<em>x</em><sub><em>p</em></sub>)</span> to its prediction. Furthermore, let <span class="math inline"><em>F</em><sub><em>s</em></sub>(<strong>x</strong><sub><em>s</em></sub>) = <em>E</em><sub><strong>x</strong><sub>\<em>s</em></sub></sub>(<em>F</em>(<strong>x</strong><sub><em>s</em></sub>,<strong>x</strong><sub>\<em>s</em></sub>))</span> be the partial dependence function of <span class="math inline"><em>F</em></span> on the feature subset <span class="math inline"><strong>x</strong><sub><em>s</em></sub></span>, where <span class="math inline"><em>s</em> ⊆ {1, …, <em>p</em>}</span>, as introduced in [1]. Here, the expectation runs over the joint marginal distribution of features <span class="math inline"><strong>x</strong><sub>\<em>s</em></sub></span> not in <span class="math inline"><strong>x</strong><sub><em>s</em></sub></span>.</p>
<p>Given data, <span class="math inline"><em>F</em><sub><em>s</em></sub>(<strong>x</strong><sub><em>s</em></sub>)</span> can be estimated by the empirical partial dependence function</p>
<p><span class="math display">$$
  \hat F_s(\boldsymbol x_s) = \frac{1}{n} \sum_{i = 1}^n F(\boldsymbol x_s, \boldsymbol x_{i \setminus s}),
$$</span></p>
<p>where <span class="math inline"><strong>x</strong><sub><em>i</em> \ <em>s</em></sub></span>, <span class="math inline"><em>i</em> = 1, …, <em>n</em></span>, are the observed values of <span class="math inline"><strong>x</strong><sub>\<em>s</em></sub></span>.</p>
<p>A partial dependence plot (PDP) plots the values of <span class="math inline"><em>F̂</em><sub><em>s</em></sub>(<strong>x</strong><sub><em>s</em></sub>)</span> over a grid of evaluation points <span class="math inline"><strong>x</strong><sub><em>s</em></sub></span>.</p>
</div>
<div class="section level3">
<h3 id="overall-interaction-strength">Overall interaction strength<a class="anchor" aria-label="anchor" href="#overall-interaction-strength"></a>
</h3>
<p>In [2], Friedman and Popescu introduced different statistics to measure interaction strength. Closely following their notation, we will summarize the main ideas.</p>
<p>If there are no interactions involving <span class="math inline"><em>x</em><sub><em>j</em></sub></span>, we can decompose the prediction function <span class="math inline"><em>F</em></span> into the sum of the partial dependence <span class="math inline"><em>F</em><sub><em>j</em></sub></span> on <span class="math inline"><em>x</em><sub><em>j</em></sub></span> and the partial dependence <span class="math inline"><em>F</em><sub>\<em>j</em></sub></span> on all other features <span class="math inline"><strong>x</strong><sub>\<em>j</em></sub></span>, i.e.,</p>
<p><span class="math display"><em>F</em>(<strong>x</strong>) = <em>F</em><sub><em>j</em></sub>(<em>x</em><sub><em>j</em></sub>) + <em>F</em><sub>\<em>j</em></sub>(<strong>x</strong><sub>\<em>j</em></sub>).</span></p>
<p>Correspondingly, Friedman and Popescu’s <span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup></span> statistic of overall interaction strength is given by</p>
<p><span class="math display">$$
    H_{j}^2 = \frac{\frac{1}{n} \sum_{i = 1}^n\big[F(\boldsymbol x_i) - \hat F_j(x_{ij}) - \hat F_{\setminus j}(\boldsymbol x_{i\setminus k})\big]^2}{\frac{1}{n} \sum_{i = 1}^n\big[F(\boldsymbol x_i)\big]^2}.
$$</span></p>
<p><strong>Remarks</strong></p>
<ol style="list-style-type: decimal">
<li>Partial dependence functions (and <span class="math inline"><em>F</em></span>) are all centered to mean 0.</li>
<li>Partial dependence functions (and <span class="math inline"><em>F</em></span>) are evaluated over the data distribution. This is different to partial dependence plots, where one uses a fixed grid.</li>
<li>Weighted versions follow by replacing all arithmetic means by corresponding weighted means.</li>
<li>Multivariate predictions can be treated in a component-wise manner.</li>
<li>
<span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup> = 0</span> means there are no interactions associated with <span class="math inline"><em>x</em><sub><em>j</em></sub></span>. The higher the value, the more prediction variability comes from interactions with <span class="math inline"><em>x</em><sub><em>j</em></sub></span>.</li>
<li>Since the denominator is the same for all features, the values of the test statistics can be compared across features.</li>
</ol>
</div>
<div class="section level3">
<h3 id="pairwise-interaction-strength">Pairwise interaction strength<a class="anchor" aria-label="anchor" href="#pairwise-interaction-strength"></a>
</h3>
<p>Again following [2], if there are no interaction effects between features <span class="math inline"><em>x</em><sub><em>j</em></sub></span> and <span class="math inline"><em>x</em><sub><em>k</em></sub></span>, their two-dimensional partial dependence function <span class="math inline"><em>F</em><sub><em>j</em><em>k</em></sub></span> can be written as the sum of the univariate partial dependencies, i.e.,</p>
<p><span class="math display"><em>F</em><sub><em>j</em><em>k</em></sub>(<em>x</em><sub><em>j</em></sub>,<em>x</em><sub><em>k</em></sub>) = <em>F</em><sub><em>j</em></sub>(<em>x</em><sub><em>j</em></sub>) + <em>F</em><sub><em>k</em></sub>(<em>x</em><sub><em>k</em></sub>).</span></p>
<p>Correspondingly, Friedman and Popescu’s <span class="math inline"><em>H</em><sub><em>j</em><em>k</em></sub><sup>2</sup></span> statistic of pairwise interaction strength is defined as</p>
<p><span class="math display">$$
  H_{jk}^2 = \frac{A_{jk}}{B_{jk}},
$$</span></p>
<p>where</p>
<p><span class="math display">$$
  A_{jk} = \frac{1}{n} \sum_{i = 1}^n\big[\hat F_{jk}(x_{ij}, x_{ik}) - \hat F_j(x_{ij}) - \hat F_k(x_{ik})\big]^2
$$</span></p>
<p>and</p>
<p><span class="math display">$$
  B_{jk} = \frac{1}{n} \sum_{i = 1}^n\big[\hat F_{jk}(x_{ij}, x_{ik})\big]^2.
$$</span></p>
<p><strong>Remarks</strong></p>
<ol style="list-style-type: decimal">
<li>Remarks 1 to 4 of <span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup></span> also apply here.</li>
<li>
<span class="math inline"><em>H</em><sub><em>j</em><em>k</em></sub><sup>2</sup> = 0</span> means there are no interaction effects between <span class="math inline"><em>x</em><sub><em>j</em></sub></span> and <span class="math inline"><em>x</em><sub><em>k</em></sub></span>. The larger the value, the more of the joint effect of the two features comes from the interaction.</li>
<li>Since the denominator differs between variable pairs, unlike <span class="math inline"><em>H</em><sub><em>j</em></sub></span>, this test statistic is difficult to compare between variable pairs. If both main effects are very weak, a negligible interaction can get a high <span class="math inline"><em>H</em><sub><em>j</em><em>k</em></sub><sup>2</sup></span>.</li>
</ol>
<p><strong>Modification</strong></p>
<p>To be better able to compare pairwise interaction strength across variable pairs, and to overcome the problem mentioned in the last remark, we suggest as alternative the unnormalized test statistic on the scale of the predictions, i.e., <span class="math inline">$\sqrt{A_{jk}}$</span>.</p>
<p>Furthermore, we do pairwise calculations not for the most <em>important</em> features but rather for those features with <em>strongest overall interactions</em>.</p>
</div>
<div class="section level3">
<h3 id="total-interaction-strength-of-all-variables-together">Total interaction strength of all variables together<a class="anchor" aria-label="anchor" href="#total-interaction-strength-of-all-variables-together"></a>
</h3>
<p>If the model is additive in all features (no interactions), then</p>
<p><span class="math display">$$
    F(\boldsymbol x) = \sum_{j}^{p} F_j(x_j).
$$</span></p>
<p>To measure the relative amount of variability unexplained by all main effects, we can therefore study the test statistic of total interaction strength</p>
<p><span class="math display">$$
  H^2 = \frac{\frac{1}{n} \sum_{i = 1}^n \left[F(\boldsymbol x_i) - \sum_{j = 1}^p\hat F_j(x_{ij})\right]^2}{\frac{1}{n} \sum_{i = 1}^n\left[F(\boldsymbol x_i)\right]^2}.
$$</span></p>
<p>A value of 0 would mean there are no interaction effects at all.</p>
</div>
<div class="section level3">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h3>
<p>Calculation of all <span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup></span> statistics requires <span class="math inline"><em>O</em>(<em>n</em><sup>2</sup><em>p</em>)</span> predictions, while calculating of all pairwise <span class="math inline"><em>H</em><sub><em>j</em><em>k</em></sub></span> requires <span class="math inline"><em>O</em>(<em>n</em><sup>2</sup><em>p</em><sup>2</sup></span> predictions. Therefore, we suggest to reduce the workflow in two important ways:</p>
<ol style="list-style-type: decimal">
<li>Evaluate the statistics only on a subset of the data, e.g., on <span class="math inline"><em>n</em>′ = 300</span> observations.</li>
<li>Calculate <span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup></span> for all features. Then, select a small number <span class="math inline">$m = O(\sqrt{p})$</span> of features with highest <span class="math inline"><em>H</em><sub><em>j</em></sub><sup>2</sup></span> and do pairwise calculations only on this subset.</li>
</ol>
<p>This leads to a total number of <span class="math inline"><em>O</em>(<em>n</em>′<sup>2</sup><em>p</em>)</span> predictions.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Friedman, Jerome H. <em>“Greedy Function Approximation: A Gradient Boosting Machine.”</em> Annals of Statistics 29, no. 5 (2001): 1189-1232.</li>
<li>Friedman, Jerome H., and Bogdan E. Popescu. <em>“Predictive Learning via Rule Ensembles.”</em> The Annals of Applied Statistics 2, no. 3 (2008): 916-54.</li>
<li>Mayer, Michael, Steven C. Bourassa, Martin Hoesli, and Donato Scognamiglio. <em>“Machine Learning Applications to Land and Structure Valuation.”</em> Journal of Risk and Financial Management 15, no. 5 (2022): 193.</li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mayer79/interactML/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mayer79/interactML/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing interactML</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Mayer <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=interactML" class="external-link"><img src="http://www.r-pkg.org/badges/version/interactML" alt="CRAN status"></a></li>
<li><a href="https://github.com/mayer79/interactML/actions" class="external-link"><img src="https://github.com/mayer79/interactML/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/mayer79/interactML?branch=main" class="external-link"><img src="https://codecov.io/gh/mayer79/interactML/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://cran.r-project.org/package=interactML" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/interactML"></a></li>
<li><a href="https://cran.r-project.org/package=interactML" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/interactML?color=orange"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
